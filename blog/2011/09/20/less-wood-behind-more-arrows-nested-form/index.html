
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rob Howard: Less wood behind more arrows: nested_form</title>
  <meta name="author" content="Rob Howard">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://robhoward.id.au/blog/2011/09/20/less-wood-behind-more-arrows-nested-form/"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Rob Howard" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12459174-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  

  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">Rob Howard</a></h1>
  
    <h2>A social dog photo-sharing Q&A site with a domain ending in .ly</h2>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:robhoward.id.au" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry">
  
  <header>
    
      <h1 class="entry-title">Less Wood Behind More Arrows: Nested_form</h1>
    
    
      <p class="meta">




<time datetime="2011-09-20 20:15:00 +1000" pubdate  updated >Sep 20<span>th</span>, 2011</time>


</p>
    
  </header>


<div class="entry-content"><p><em>(Or, &#8220;Crazy forks everywhere&#8221;.)</em></p>

<p>All the way back in <a href="http://railscasts.com/episodes/197-nested-model-form-part-2">RailsCast 197</a> Ryan Bates introduced us to his javascript-powered dynamic nested form gem, <a href="http://github.com/ryanb/nested_form">nested_form</a>. It&#8217;s pretty useful, and in concert with Rails&#8217; existing <code>accepts_nested_attributes_for :relation</code>, got pretty close to solving a problem I haven&#8217;t ever seen cleanly solved without unwieldy controller code and custom javascript.</p>

<p>Ryan has previously kept it up to date (bless his socks), but now after a three months and a gradual accumulation of about twenty outstanding pull requests (some that fix niggles like hardcoded markup, the undocumented testing environment, and weird jumbled-attribute record creation bugs), I need to move on so I can <a href="https://github.com/smashcon/lincoln">get back to work</a>.</p>

<p>Fortunately, <a href="https://github.com/elmatou">elmatou</a> forked <code>nested_form</code>, merged a bunch of changes and made plenty of his own, and put it all in <a href="https://github.com/elmatou/nested_form/tree/defacto">a branch called &#8216;defacto&#8217;</a>. These changes include:</p>

<ul>
<li>Configurable wrapper markup,</li>
<li>Actual removal of &#8216;removed&#8217; forms,</li>
<li>Positionable insertion of newly-added nested forms,</li>
<li>Storage of the field template in a javascript variable, not inside a hidden <code>&lt;div&gt;</code> (meaning your markup doesn&#8217;t break when using Formtastic).</li>
</ul>


<p>Also fortunately, <a href="https://github.com/fxposter">fxposter</a> (a long-time <code>nested_form</code> committer) has <a href="https://github.com/fxposter/nested_form">also forked</a>, and improved the testing situation by swapping out Appraisal with an integrated dummy app.</p>

<p>As is tradition for any moderately popular project, there are a ton more forks and the situation is as messy as hell, but if you need one of the above fixes sooner than later, then pull in one of these versions of <code>nested_form</code> by putting the following in your Gemfile:</p>

<div><figure role=code> <div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
</pre></td><td class='code' width='100%'><pre><code class='ruby'><div class='line'><span class="c1"># The Ryan Bates original:</span>
</div><div class='line'><span class="c1">#gem &#39;nested_form&#39; # The Ryan Bates original</span>
</div><div class='line'>
</div><div class='line'><span class="c1"># Fxposter&#39;s fork:</span>
</div><div class='line'><span class="n">gem</span> <span class="s1">&#39;nested_form&#39;</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">&#39;git://github.com/fxposter/nested_form.git&#39;</span>
</div><div class='line'>
</div><div class='line'><span class="c1"># Elmatou&#39;s fork:</span>
</div><div class='line'><span class="n">gem</span> <span class="s1">&#39;nested_form&#39;</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">&#39;git://github.com/elmatou/nested_form.git&#39;</span><span class="p">,</span> <span class="ss">:branch</span> <span class="o">=&gt;</span> <span class="s1">&#39;defacto&#39;</span>
</div></code></pre></td></tr></table></div></figure></div>


<p>I&#8217;ve elected to go with Elmatou&#8217;s fork (for the moment) for the configurable markup. Formtastic&#8217;s ordered <code>&lt;li&gt;</code> field setup is not friendly at all with Ryan&#8217;s hardcoded <code>&lt;div&gt;</code> method.</p>

<p>(tl;dr <a href="https://github.com/ryanb/nested_form">nested_form</a> has some odd bugs, <a href="https://github.com/elmatou/nested_form/tree/defacto">elmatou&#8217;s fork</a> has less, but <a href="https://github.com/fxposter/nested_form">fxposter&#8217;s fork</a> has a better testing setup. I&#8217;m using elmatou&#8217;s to <a href="https://github.com/smashcon/lincoln">get on with building stuff</a>. It&#8217;s all kind of sad right now.)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Rob Howard</span></span>

      




<time datetime="2011-09-20 20:15:00 +1000" pubdate  updated >Sep 20<span>th</span>, 2011</time>



      

<span class="categories">
  
    <a class='category' href='/blog/categories/Forms/'>Forms</a>, <a class='category' href='/blog/categories/Rails/'>Rails</a>, <a class='category' href='/blog/categories/Ruby/'>Ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://robhoward.id.au/blog/2011/09/20/less-wood-behind-more-arrows-nested-form/" data-via="damncabbage" data-counturl="http://robhoward.id.au/blog/2011/09/20/less-wood-behind-more-arrows-nested-form/" >Tweet</a>
  
  
</div>

    
  </footer>
</article>

</div>

<aside role=sidebar>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/12/12/php-sadness-short-long-days-of-the-week/">PHP Sadness: Short Long Days of the Week</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/09/20/less-wood-behind-more-arrows-nested-form/">Less wood behind more arrows: nested_form</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/03/26/stop-gnome-hijacking-ssh-key-entry/">Stop GNOME &#8220;Hijacking&#8221; SSH Key Entry</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("damncabbage", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/damncabbage" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @damncabbage</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/js/damncabbage?title=&count=3&sort=date&extended"></script>
  <p><a href="http://delicious.com/damncabbage">My Delicious Bookmarks &raquo;</a></p>
</section>


  
</aside>


    </div>
  </div>
  <footer><p>
  Copyright &copy; 2011 - Rob Howard -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
